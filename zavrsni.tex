\documentclass[times, utf8, zavrsni]{fer}

\usepackage{booktabs}
\usepackage{url}
\usepackage{indentfirst}
\usepackage{listings}

\lstset{
  escapechar=\&,
  captionpos=b,
  basicstyle=\ttfamily\footnotesize\bfseries,
  frame=tb,
}
\renewcommand{\lstlistingname}{Kod}
\renewcommand{\lstlistlistingname}{Popis kodova}

\begin{document}

\thesisnumber{5191}
\title{Primjena paradigme poslužiteljskih dojava u razvoju web-usluga}
\author{Karlo Vrbić}

\maketitle

% Dodavanje zahvale ili prazne stranice. Ako ne želite dodati zahvalu, naredbu ostavite radi prazne stranice.
\zahvala{}

\tableofcontents
\listoffigures
\lstlistoflistings

\chapter{Uvod}

U 21. stoljeću svjedočimo sve bržem razvoju tehnologija u svim područjima, a najviše na području informacijskih tehnologija i mobilnih tehnologija. Danas je nezamisliv život bez mobilnih uređaja poput prijenosnih računala, pametnih mobitela, tableta, pametnih satova, itd. To potvrđuje podatak da 60\% ljudi posjeduje mobilni telefon i da danas većina ljudi internetu pristupa pomoću mobilnih uređaja. Do tako drastičnog porasta broja korisnika mobilnih uređaja došlo je ponajviše razvojem tzv. pametnih mobitela. Danas tržištem dominiraju Android i iOS pametni mobilni uređaji koji korisniku pružaju mnoge mogućnosti koje nisu bile dostupne tradicionalnim mobilnim telefonima. Uz razvoj mobilnih mreža i bežičnog interneta korisnicima je omogućeno da budu spojeni na internet bez obzira na vrijeme i mjesto gdje se nalaze. Ti podatci drastično mijenjaju način na koji korisnici koriste svoje uređaje. Od uređaja se više ne zahtjeva samo da može pristupiti informacijama bitnih korisniku nego i da može primati informacije iz više izvora u tren kada te informacije budu dostupne. Standardna klijentsko-poslužnička arhitektura ne zadovoljava tim uvjeta i u tome je motivacija za razvoj tehnologija poslužiteljskih dojava.

\chapter{Tehnologije poslužiteljskih dojava}

\section{Comet}
U početcima World Wide Web tehnologije internet preglednici za svaku stranicu poslao više zahtjeva prema poslužitelju, svaki zahtjev za jednu komponentu stranice, npr. HTML dokument, CSS dokument, skripte ili bilo koji drugi resurs koji se upotrebljavao na stranici. Preuzimanje stranice u dijelove podataka poznato je kao model stranica po stranica model\engl{Page-by-Page model}. Za dohvat novog sadržaja stranice stranica se trebala ponovo učitati.

AJAX(Asynchronous Javascript and XML) tehnologija je donijela promjene i omogućila učitavanje dijelova stranice kroz asinkrone zahtjeve prema poslužitelju ali AJAX nije riješio sve probleme dinamičkih web stranica. Iako web preglednici sa AJAX-om imaju mogućnost zatražiti podatke sa servera i dinamički izmijeniti stranicu kada ti podatci stignu i dalje nisu imali mehanizam kojim bi znali da li server uopće ima nove podatke u slučajevima kada je to potrebno, npr. chat aplikacije. U takvim slučajevima se koristila tzv. \glqq polling\grqq\  tehnika.\citep{gravelle2009comet}

\subsection{Polling}
\glqq Polling\grqq\  tehnika je tehnika ostvarivanja poslužiteljskih dojava koja koristi periodičko slanje zahtjeva prema poslužitelju i na taj način doznaje da li poslužitelj ima relevantnih podataka koje bi klijent trebao prikazati. Ova tehnika ustvari nije prava \glqq push\grqq\  tehnologija jer bi takva tehnologija omogućila poslužitelju slanje podataka klijentu bez zahtjeva klijenta. Ovu tehniku možemo podijeliti na dvije kategorije: \glqq polling\grqq\  i \glqq long polling\grqq .

\glqq Polling\grqq\  tehnika se obično ostvaruje tako da klijent ostvari vezu prema poslužitelju, pošalje HTTP zahtjeve prema poslužitelju, poslužitelj odgovara klijentu i šalje mu podatke sa dojavom ukoliko je dostupna te se nakon što klijent primi odgovor veza raskida. Ovaj proces bi se periodički ponavljao te bi tako korisnik naizgled imao prave poslužiteljske dojave. Ova tehnika se obično koristila na internet stranicama pomoću periodičkih AJAX zahtjeva. Problemi ovakve implementacije poslužiteljskih dojava su očiti. Zbog potrebe za slanjem periodičkih HTTP zahtjeva koji su često i bespotrebnih poslužitelja se tjera na nepotrebnu obradu velikog broja zahtjeva što zahtjeva bolji i skuplji hardver ali i povećava internet promet zbog učestalih zahtjeva.

\begin{figure}[htb]
\centering
\includegraphics[width=14cm]{img/long-polling.png}
\caption{Dijagram razmjene dojava primjenom \glqq long polling\grqq\  tehnike}
\label{fig:long-polling-image}
\end{figure}

Sustavi koji upotrebljavaju \glqq polling\grqq\  tehniku su ne skalabilni jer veći broj korisnika drastično povećava broj zahtjeva koje server mora obrađivati što je skupo i ne održivo. Zbog navedenih problema sa normalnom \glqq polling\grqq\  tehnikom razvijena je tehnika \glqq long polling\grqq . Ova tehnika je slična svom prethodniku ali se razlikuje u načinu na koji poslužitelj odgovara. Koristeći ovu tehniku klijent mora ostvariti vezu sa poslužiteljom, poslati HTTP zahtjev prema poslužitelju ali poslužitelj neće odmah odgovoriti(slika \ref{fig:long-polling-image}). Kod HTTP-a TCP veza se održava sve dok klijent ne dobije odgovor. Ova činjenica je ovdje iskorištena na način da će poslužitelj pričekati dok relevantni podatci ili dojave ne budu dostupne pa će tek onda kada je to potrebno poslati odgovor klijentu. Klijent nakon što zaprimi odgovor šalje novi zahtjev poslužitelju i proces se ponavlja. Ako se ipak zbog nekih razloga veza raskine prije nego što poslužitelj pošalje odgovor klijent pokušava ostvariti novu vezu i poslati novi zahtjev. Iako se ovom tehnikom rješava problem velikog broja zahtjeva stvara se novi problem. Većina modernih poslužitelja radi na način da za svaki zahtjev stvara novi proces ili dretvu i nakon obrade zahtjeva prekida proces ili dretvu ili zahtjeve predaje dretvi iz bazena dretvi nakon obrade zahtjeva  vraća dretvu u bazen dretvi. Problem je što koristeći ovu tehniku većinu vremena poslužitelj čeka podatke koje treba poslati a za to vrijeme ima proces ili dretvu koja ne radi ništa osim što koristi resurse poslužitelja koji bi se mogu koristiti za ostale zadatke. Još gori je problem ukoliko se koristi bazen dretvi jer može doći do situacije u kojoj sve dretve iz bazena čekaju podatke pa nema ni jedne dretve dostupne za obradu novih zahtjeva koji čekaju u redu ili se odbacuju.

\subsection{Streaming}
Pored \glqq polling\grqq\  tehnika imamo i \glqq streaming\grqq\  tehniku ostvarivanja poslužiteljskih dojava. Ova tehnika se ostvaruje pomoću jedne veze koju klijent ostvari sa poslužiteljem koju potom poslužitelj koristi za slanje dojava klijentu. Ako se odlučimo za implementaciju ove tehnike imamo dvije opcije: korištenje metode skrivenih iframe-ova ili korištenje višestrukog odgovora pomoću XMLHttpRequest objekta koji se koristi pri slanju AJAX zahtjeva.

\glqq iframe\grqq\  je HTML element koji se koristi za ugradnju dokumenta unutar drugog HTML dokumenta. Pri implementaciji streaming Comet tehnike može se koristiti skriveni iframe element čiji će \glqq src\grqq\  atribut pokazivati na URL s kojeg će poslužitelj slati dojave. Svaki put kada poslužitelj ima dojavu za klijenta on će tu dojavu zapakirati u Javascript skriptu koju će klijent dobiti kroz iframe element te će je potom izvršiti.\citep{carbou2011}

\section{WebSocket}
Povijesno, stvaranje web aplikacija koje trebaju dvosmjernu komunikaciju između klijenta i poslužitelja zahtijevala je korištenje HTTP-a na način na koji HTTP nije namijenjen. Jednostavnije riješenje bi bilo da se koristi jedna TCP veza. Upravo na tome je radila IETF(engl. Internet Engineering Task Force) i objavila pod RFC 6455 specifikacijom. Protokol se zove WebSocket i zajedno sa WebSocket API-ijem daje alternativu \glqq pollingu\grqq\  i sličnim tehnikama. WebSocket protokol pokušava riješiti ciljeve postojećih dvosmjernih HTTP tehnologija u kontekstu postojeće HTTP infrastrukture. Kao takav, osmišljen je za rad preko HTTP portova 80 i 443, kao i za podršku HTTP posrednika.

Protokol trenutno podržavaju svi poznatiji internet preglednici poput Firefox(PC i Android verzija), Chrome(PC i mobilna verzija), Safari(PC i iOS verzija), Opera(PC i mobilna verzija), Internet Explorer i Android browser.

Protokol se sastoji od dva dijela: rukovanja\engl{handshake} i prijenosa podataka.\citep{rfc6455}

\begin{figure}[htb]
\centering
\includegraphics[width=14cm]{img/websocket.png}
\caption{Dijagram razmjene dojava primjenom \glqq WebSocket\grqq\  tehnologije}
\label{fig:websocket-image}
\end{figure}

\subsection{Rukovanje}
Klijent tijekom rukovanja poslužitelju šalje zahtjev(kod \ref{lst:websocket-rukovanje-1}) na koji poslužitelj odgovara(kod \ref{lst:websocket-rukovanje-2}).
\begin{lstlisting}[caption=Zahtjev klijenta tijekom rukovanja, label=lst:websocket-rukovanje-1, float, floatplacement=H]
GET /chat HTTP/1.1
Host: server.example.com
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==
Origin: http://example.com
Sec-WebSocket-Protocol: chat, superchat
Sec-WebSocket-Version: 13
\end{lstlisting}

\begin{lstlisting}[caption=Odgovor poslužitelja tijekom rukovanja, label=lst:websocket-rukovanje-2, float, floatplacement=H]
HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=
Sec-WebSocket-Protocol: chat
\end{lstlisting}

Klijent uključuje hostname u Host zaglavlje rukovanja prema tako da i klijent i poslužitelj mogu potvrditi da se slažu o tome koji je host u upotrebi.

Dodatna polja zaglavlja koriste se za odabir opcija u WebSocket protokolu. Tipične opcije dostupne u ovoj verziji su selektor podprotokola (\glqq Sec-WebSocket-Protocol\grqq\ ), popis ekstenzije podrške od strane klijenta (\glqq Sec-WebSocket-Extensions\grqq\ ), \glqq Origin\grqq\  zaglavlje itd. 

\glqq Sec-WebSocket-Protocol\grqq\  zaglavlje zahtjeva može se upotrijebiti za označavanje podprotokola koje klijent podržava. Poslužitelj odabire jedan ili nijedan od prihvatljivih protokola i šalje tu vrijednost tijekom rukovanja kako bi naznačio da je odabrao taj protokol.

Rukovanje je slično HTTP-u dopuštajući poslužiteljima da obrađuju HTTP i WebSocket veze na istom portu. Kada se uspostavlja veza, komunikacija prelazi na dvosmjerni protokol koji ne odgovara HTTP protokolu. Uz \glqq Upgrade\grqq\  zaglavlje klijent šalje i \glqq Sec-WebSocket-Key\grqq\  zaglavlje koje sadrži nasumične oktet kodirane sa base64 algoritmom a poslužitelj odogovara sa hash vrijednosti tog ključa u \glqq Sec-WebSocket-Accept\grqq\  zaglavlju.

\subsection{Prijenos podataka}
Nakon rukovanja i klijent i poslužitelj mogu poslati podatke u oba smjera. WebSocket prijenosi zovu se poruke, gdje se jedna poruka može po želji podijeliti na više okvira podataka. To može omogućiti slanje poruka gdje su početni podaci dostupni, ali cjelokupna duljina poruke je nepoznata (šalje se jedan podatkovni okvir nakon drugog dok se ne postigne kraj i označeno s bitom FIN). Uz proširenja protokola, to se također može koristiti za multipleksiranje nekoliko veza istovremeno. 

Svaki okvir ima svoju vrstu ali svi okviri koji čine jednu poruku moraju biti iste vrste. Općenito govoreći, postoje vrste za tekstualne podatke (koji se tumače kao tekst kodiran UTF-8 kodnom stranicom), binarne podatke (čija interpretacija ostaje do aplikacije) i kontrolne okvire (koji nisu namijenjeni za prijenos podataka za aplikaciju Ali umjesto toga za signalizaciju na razini protokola, kao da signalizira da veza bude zatvorena). Ova verzija protokola definira šest vrsta okvira i ostavlja deset rezerviranih za buduću upotrebu.

\section{Firebase Cloud Messaging (FCM)}

\subsection{Povijest}
Pojavom Android pametnih mobilnih telefona Google, kompanija iza Androida, tražila je riješenje za omogućivanje dvosmjerne komunikacije između Android aplikacija i poslužitelja. Postojeća rješenja nisu bila dovoljno dobra za mobilne uređaje. Jedan od razloga je da korisnik mobilnog uređaja može od jednom imati veliki broj aplikacija koje zahtjevaju opciju poslužiteljskih dojava a postojeće tehnologije su koristile jednu vezu po aplikaciji. Problem je što su mobilni uređaji relativno slabiji od osobnih uređaja i nisu bili u mogućnosti koristiti veliki broj veza odjednom.

Prva verzija protokola nazvala se AC2DM(Android Cloud to Device Messaging). Protokol je omogućavao sve aplikacije primaju poslužiteljske dojave preko jedne veze sa Google-ovim poslužiteljem. GCM(engl. Google Cloud Messaging) usluga najavljena je u lipnju 2012. kao nasljednik protokola Android Cloud to Device Messaging. Poboljšanja su uključivala poboljšanja za provjeru autentičnosti i isporuke, nove krajnje točke API-ja i parametre za razmjenu poruka, te uklanjanje ograničenja na broj odaslanih poruka i veličine poruka. 2014 godine Google preuzima tvrtku Firebase i pod imenom Firebase Cloud Messaging izbacuje protokol koji je sada dostupan na Android i iOS pametnim mobilnim uređajima ali i na klasičnim web aplikacijama.

\begin{figure}[htb]
\centering
\includegraphics[width=1cm]{img/fcm.png}
\caption{Princip rada Firebase Cloud Messaging servisa}
\label{fig:fcm-image}
\end{figure}

\subsection{Prijava na uslugu}
Firebase Cloud Messaging protokol radi na način da klijent koji na svom uređaju ima barem jednu aplikaciju koju koristi FCM protokol mora ostvariti vezu sa FCM poslužiteljem(slika \ref{fig:fcm-image} postupak 1). Na Android uređajima svaka aplikacija mora imati servis koji će inicirati vezu sa FCM poslužiteljem i dobiti token jedinstven za svaku aplikaciju(slika \ref{fig:fcm-image} postupak 2). Nakon što klijent dobije token on ga šalje svom poslužitelju koji bi trebao token spremiti ukoliko planira slati dojave tom klijentu(slika \ref{fig:fcm-image} postupak 3). 

Klijent isto tako ima mogućnost prijave na razne teme. Teme su skupine klijenata koji žele primati iste dojave a svaka tema se identificira pomoću svog jedinstvenog imena. FCM poslužitelj pamti koji klijenti su se pretplatili na koje teme te koriste tu informaciju prilikom slanja dojave.

\subsection{Slanje dojava i podataka}
Kada poslužitelj poželi poslati dojavu korisniku on za to koristi token koji je prije toga dobio i FCM poslužitelje. Na FCM poslužitelj šalje JSON objekt preko HTTP ili XMLL protokola. JSON objekt se sastoji od dva atributa: \glqq to\grqq\  ili \glqq condition\grqq , \glqq notification\grqq\  i \glqq data\grqq\ (slika \ref{fig:fcm-image} postupak 4), a zatim FCM poslužitelj obrađuje dojavu, sprema u svoju bazu podataka ako klijent nije spojen ili šalje dojavu klijentu(slika \ref{fig:fcm-image} postupak 5) sa JSON objektom(kod \ref{lst:json-dojava}) kao tijelom poruke.

\begin{lstlisting}[caption=Primjer JSON objekta kojeg poslužitelj šalje FCM poslužitelju za slanje dojave, label=lst:json-dojava, float]
{
    "to" : "APA91bHun4MxP5egoKMwt2&\ldots&",
    "notification" : {
      "body" : "Ovdje se nalazi tijelo dojave",
      "title" : "Ovdje se nalazi naslov dojave",
      "icon" : "Ovdje se nalazi ime ikone koja &\'c&e se prikazati uz dojavu"
    },
    "data" : {
      "example1" : "value1",
      "example2" : "value2"
    }
}
\end{lstlisting}

Prvi atribut može biti \glqq to\grqq\  ili \glqq condition\grqq\  i oba služe za određivanje klijenta ili više njih kome će slati dojava. Kod atributa \glqq to\grqq\  to može biti token koji je prije toga klijent poslao svom poslužitelju ili može biti ime teme. Vrijednost atributa \glqq condition\grqq\  sadrži neke uvijete koje primatelji moraju ispunjavati, npr. \glqq "condition": "'dogs' in topics || 'cats' in topics"\grqq\  znači da će se dojava poslati klijentima koji su pretplaćeni na teme \glqq dogs\grqq\  ili \glqq cats\grqq\ .U oba slučaja FCM poslužitelj koristi ovaj podatak da razluči kome treba poslati dojavu.

Atribut \glqq notification\grqq\  se koristi za slanje dojava koje će se prikazati u dijelu za dojave na klijentskom operacijskom sustavu. Ovaj atribut je objekt koji se sastoji od atributa poput \glqq body\grqq , \glqq title\grqq , \glqq icon\grqq , itd. koji određuju informacije koje će se prenijeti ali i koja će se ikonica prikazati uz dojavu ili koji zvuk će se oglasiti prilikom primitka dojave.

Atribut \glqq data\grqq\  se koristi ukoliko se treba poslati veća količina podataka. Pomoću ovog atributa može se poslati do 4kB podataka u obliku ključ-vrijednost. iOS klijent će ove podatke primiti tek kada klijentska aplikacija dođe u prednji plan dok će Android aplikacija obraditi podatke i kad je u pozadini. U slučaju ako se šalju i \glqq notification\grqq\  i \glqq data\grqq\  atribut dojava će se prikazati i ako je aplikacija u pozadini dok će se \glqq data\grqq\  atribut obraditi tek kada aplikacija dođe u prednji plan.\citep{fcm2017}

\section{Apple Push Notification Service}

Prvi pametni mobilni uređaj iPhone kompanije Apple pokrenuo je revoluciju u razvoju mobilnih uređaja i izmjenio način na koji korisnici koriste svoje mobilne uređaje. Veliki broj aplikacija se oslanjao na poslužiteljske dojave ali nije bilo adekvatnog rješenja. Apple se susreo sa istim problemima kao i njihov konkurent Google pa su se odlučili za izradu vlastitog servisa za poslužiteljske dojave.

2008 godine napravljen je servis nazvan APNs(engl. Apple Push Notification Service). Usluga podržava iOS pametne mobilne telefone, watchOS pametne satove, tvOS pametne televizore i macOS osobna i prijenosna računala.

Princip rada je sličan Firebase Cloud Messaging usluzi. Klijenti se registriraju kod APNs poslužitelja i APNs vodi računa o vezama sa klijentima. Poslužitelj kada poželi poslati dojavu šalje zahtjev prema APNs poslužitelju koji šalje te dojave klijentima.

\begin{figure}[htb]
\centering
\includegraphics[width=14cm]{img/apns.png}
\caption{Upravljanje tokenom uređaja koristeći APNs}
\label{fig:apns-image}
\end{figure}

\subsection{Prijava na uslugu}

Po početnom pokretanju aplikacije na korisničkom uređaju sustav automatski uspostavlja akreditiranu, šifriranu i postojanu IP vezu između aplikacije i APNs poslužitelja. Ta veza omogućuje vašoj aplikaciji da izvrši postavljanje kako bi omogućila primanje dojava. APNs poslužitelj nakon stvaranja veze sa klijentom generira paket sa token, generira ID uređaja pomoću certifikata uređaja te još enkriptira token sa ključem tokena. Ako je proces autentikacije uspješno izvršen klijentska aplikacija dobije token. Svaki token je jedinstven za aplikaciju i uređaj koji korisnik koristi(slika \ref{fig:apns-image}).
\subsection{Slanje dojava i podataka}

Poslužitelj pri slanju dojave šalje zahtjev APNs poslužitelju preko HTTP/2 protokola. U tijelu zahtjeva treba poslati JSON objekt koji ne prelazi veličinu od 4kB ili 	VoIP poruku koja ne prelazi 5kB.

JSON objekt se sastoji od atributa \glqq aps\grqq\  i drugih atributa koji nemaju određeno ime a koriste su za prijenos podataka u obliku ključ-vrijednost. Vrijednost atributa \glqq aps\grqq\  je objekt koji sadrži atribute \glqq title\grqq , \glqq body\grqq\ , \glqq alert\grqq , \glqq sound\grqq , itd. koji određuju sadržaj notifikacije i način prikaza. Ako se želi poslati tzv. \glqq tiha\grqq\  dojava pošalje se posebno oblikovani zahtjev(kod \ref{lst:tiha-dojava}).

\begin{lstlisting}[caption=JSON objekt za \glqq tihu\grqq\  dojavu, label=lst:tiha-dojava, float]
{
    "aps" : {
        "content-available" : 1
    }
}
\end{lstlisting}

Tiha dojava označava aplikaciji da ima dostupne dojave i da ih može dohvatiti kada to poželi.\citep{apns2017}

\chapter{Arhitektura aplikacije}

\section{Ideja}
Ideja je napraviti aplikaciju koja korisniku omogućava praćenje događaja poput koncerata, rođendana i sl. i informacija vezanih uz taj događaj. Isto tako korisnici trebaju imati mogućnost kreiranja događaja za koje mogu definirati nekakve atribute poput naziva događaja, opisa, datuma i sl. Svi pratioci koji prate određeni događaj bi trebali dobiti dojavu kada se kreator događaja odluči izmijeniti neki od atributa događaja ili odluči poslati poruku vezanu uz taj događaj. Tako će se dobiti aplikacija koja će biti koristan alat pri organizaciji manjih događaja ali i većih događaja. Aplikacija se lako može pretvoriti u manju društvenu mrežu na kojoj će fokus biti na događajima, a ne na objavama kao većina društvenih mreža. Aplikacija se sastoji od poslužiteljskog dijela i klijentskog dijela.

\section{Protokol za razmjenu podataka}

Za funkcioniranje aplikacije mora se implementirati protokol za razmjenu podataka između poslužitelja i klijenta. Većina razmjene podataka u ovoj aplikaciji otpada na klijentske zahtjeve i poslužiteljske odgovore i stoga će se koristiti HTTP/1.1 koji će u svom tijelu sadržavati poruku u JSON formatu. HTTP i JSON su standardne tehnologije kada su u pitanju slične aplikacije poput ove jer je prijenos podataka jednostavan i ne koristi puno internetskog prometa.

\section{Autentikacija}

Aplikacija treba imati mogućnosti registracije i prijave kako bi raspoznala korisnike i pamtila njihove odabire. Svaki korisnik bi trebao imati jedinstveno korisničko ime. Prilikom otvaranja klijentske aplikacije korisnika se mora zatražiti da unese svoje korisničko ime i lozinku. Ako se radi o novom korisniku mora mu se ponuditi mogućnost registracije, a pri registraciji korisnici bi trebali unijeti svoje osobne podatke, korisničko ime njihovog budućeg računa i lozinku. Nakon što unese korisničko ime i lozinku korisnik pomoću klijentske aplikacije šalje zahtjev prema poslužitelju koji će utvrditi da li se radi o ispravnim podacima. Ako se radi o ispravnim podacima poslužitelj će izračunati \glqq token\grqq\  koristeći OAuth2 standard. Tijekom svoje komunikacije sa poslužiteljem, klijent će koristiti dobiveni token kako bi poslužitelj svaki put mogao provjeriti da li se zaista radi o pravom korisniku.

\section{Spremanje podataka}

Poslužiteljski dio je odgovoran za spremanje svih podataka vezanih uz aplikaciju. Za spremanje podataka koristiti ćemo relacijske baze podataka, a za lakši rad i lakše pristupanje bazi podataka koristiti ćemo objektno-relacijsko mapiranje(engl. object-relational mapping).

\section{Poslužiteljske dojave}

Poslužiteljske dojave se ovdje koriste kao način na koji se obavješćuje pretplatnika o izmjenama u događajima koje prate. Pošto izmjene mogu biti veoma bitne korisniku vrlo je bitno da se poruke dostave u što kraćem roku ali i da se ne izgube ukoliko klijent nije spojen na poslužitelj u tom trenutku(npr. korisnikov uređaj nema pristup internetu ili je ugašen).

\chapter{Implementacija}

\section{Poslužiteljske dojave}

Prilikom odabira tehnologije za poslužiteljske dojave velika pažnja je bila na brzini slanja dojava i načinu na koji određena tehnologija rješava problem korisnika koji nije spojen na poslužitelj u trenutku dolaska dojave. Isto tako bitno je koje sve platforme ta tehnologija podržava jer bi u budućnosti mogli poželjeti izraditi klijentsku aplikaciju za neku drugu platformu.

Odabrao sam Firebase Cloud Messaging servis. Firebase Cloud Messaging pruža mogućnost brzog slanja dojava, a ako dojavu nije moguće poslati u trenutku kada se dojava pojavila(npr. korisnik nije spojen na internet ili je ugasio uređaj) FCM servis će automatski spremiti dojavu i poslati je čim korisnik ponovo ostvari vezu sa FCM poslužiteljem. Velika prednost Firebase-ovog servisa je ta da je više-platformski. FCM podržava Android i iOS operativne sustave ali i klasične web aplikacije.

\section{Klijent}

Pri implementaciji klijenta odlučio sam se za Android platformu. Prednost naspram klasičnih web aplikacija je ta da klijent može imati stalne pozadinske procese koji će biti u mogućnosti primati dojave i kad korisnik ne koristi aplikaciju dok je prednost naspram iOS platforme ta da se pametni mobilni telefoni sa iOS operativnim sustavom manje koriste nego Android telefoni. U 4. kvartetu 2016. godine od svih prodanih mobilnih uređaja 81.7\% \citep{vincent2017} su bili pametni mobilni telefoni sa Android operativnim sustavom. Time Android dobiva prioritet pri izradi klijentske aplikacije.

Za spajanje na poslužitelja koristio sam dvije knjižnice: OkHttp i Retrofit2. OkHttp je HTTP klijent koji uz mogućnost slanja HTTP zahtjeva koristi i bazen veza za smanjenje latencije zahtjeva, cache odgovora za sprečavanje ponovljenih zahtjeva te podržava HTTP/2 što je korisno ukoliko se bude mijenjao protokol u budućnosti. Retrofit2 je knjižnica koja se koristi za jednostavniju uporabu oblikovnog obrazca repozitorij kod repozitorija koji koristi HTTP vezu.

Za svaku aplikaciju vrlo bitno je da je responzivna u svim trenucima. Kako bi rješavanju tog problema pristupili što lakše koristio sam knjižnicu RxJava2 koja nam omogućuje tzv. \glqq Reactive\grqq\  programiranje sa Java programskim jezikom. RxJava2 nam omogućuje da lako upravljamo dretvama i paraleliziramo poslove koje obavlja aplikacija. Da bi aplikacija bila brza i responzivna sve poslove koji bi mogli malo dulje trajati je poželjno raditi na posebnoj dretvi.

Da bi omogućili klijentu vezu sa Firebase Cloud Messaging poslužiteljem moramo koristiti Android knjižnicu za FCM pomoću koje sam napravio servis koji će biti obaviješten kada korisnik primi dojavu. Taj servis će pri primljenoj dojavi, tu dojavu obraditi i na kraju obavijestiti korisnika sa obavijesti u traci za dojave.

\section{Poslužitelj}

Pri implementaciji poslužiteljskog dijela aplikacije koristio sam Java EE tehnologije zbog toga što su Java programi više-platformski, ali i zbog česte uporabe ove platforme u implementaciji velikih sustava za razne kompanije. Zbog dobre zastupljenosti danas za u ovoj tehnologiji za neke česte probleme postoje dobra i isprobana rješenja što uvelike smanjuje količinu rada sa moje strane.

Za prihvaćanje zahtjeva sa klijenta i razvoj API-a koristio sam Jersey. Jersey je implementacija JAX-RS(Java API for RESTful Web Services) specifikacije koja je napravljen za lakšu implementaciju REST i sličnih API-a. Ovom metodom ne moramo ništa eksplicitno podešavati osim što moramo označiti koja metoda će se pokrenuti za koji tip zahtjeva.

Spremanje podataka i pretraga tih podataka je najvažnija zadaća poslužiteljskog dijela programa. Za bazu podataka sam odabrao MySQL zbog toga što je to besplatna baza podataka otvorenog koda. MySQL je veoma popularna baza podataka i stoga ima veliku potporu zajednice pa je stoga primamljiv odabir naspram drugih besplatnih rješenja. Za rad sa bazom podataka sam koristio knjižnicu za objektno-relacijsko mapiranje Hibernate. Hibernate je implementacija JPA(Java persistency API) specifikacije koja koristi Java objekte za kreiranje tablica i spremanje podataka. Uz osnovne funkcionalnosti objektno-relacijsko mapiranja Hibernate podržava laku integraciju sa sustavima za cache-iranje poput EhCache-a. EhCache će spremati pozive prema bazi podataka u memoriju tako da će uvelike ubrzati rad sa bazama podataka koji često zna usporiti ostatak aplikacije.

Prilikom interakcije sa klijentom bitno je da poslužitelj može pouzdano utvrditi identitet korisnika koji šalje upite i stoga sam koristio Apache Oltu knjižnicu. Apache Oltu podržava OAuth i OAuth2 protokole i ova knjićnica je veoma jednostavna za korištenje.

\chapter{Zaključak}

U ovom završnom radu predstavljena su tehnologije za poslužiteljske dojave, od starijih rješenja koja su imitirala poslužiteljske dojave poput \glqq long polling-a\grqq\  do novih tehnologija poput \glqq WebSocket-a\grqq\  i servisa poput \glqq Firebase Cloud Messaging-a\grqq . Prikazano je kako se prvo problem poslužiteljskih dojava pokušao riješiti raznim domišljatim metodama korištenja HTTP-a, dok moderna rješenja uključuju nove protokole koji koriste TCP vezu za slanje u oba smjera.

Prije izrade ovog rada malo toga sam znao o tome kako funkcioniraju poslužiteljske dojave i koje se tehnologije koriste. Tijekom pripreme i izrade ovog završnog rada naučio sam dosta o prijašnjim metodama imitacije poslužiteljskih dojava, ali i o modernim tehnologijama i uslugama. Osim učenja kroz proučavanje tehnologija sa \glqq Firebase Cloud Messaging-om\grqq\  sam se imao prilike više upoznati kroz praktični rad gdje sam paradigmu poslužiteljskih dojava koristio za dojavljivanja promjena na korisniku važnim događajima.

\bibliography{literatura}
\bibliographystyle{fer}

\begin{sazetak}
Dolazak pametnih mobilnih telefona ali i drugih prijenosnih uređaja uvelike je promijenio način korištenja aplikacija. Korisnici danas zahtjevaju da informacija dolazi do njih čim bude dostupna umjesto da je oni moraju zahtijevati. Kroz ovaj rad predstavljeno je par načina na koji je se ovaj problem pokušao riješiti. Jedan od načina, Firebase Cloud Messaging, sam implementirao na Android platformi kako bi bolje shvatio način rada i integracije takvih i sličnih sustava u vlastitu aplikaciju.

\kljucnerijeci{Ključne riječi, odvojene zarezima.}
\end{sazetak}

% TODO: Navedite naslov na engleskom jeziku.
\engtitle{Application of Server Push Notifications in Web Service Development}
\begin{abstract}
The arrival of smartphones and other portable devices has greatly changed the way the apps are used. Users today require information to be available as soon as it is available instead of having to request it manually. This work presents a few ways in which this problem has been tackled. I've implemented one of those services, Firebase Cloud Messaging, on an Android platform to better understand the way you work and integrate such and similar systems into your own application.

\keywords{Keywords.}
\end{abstract}

\end{document}
